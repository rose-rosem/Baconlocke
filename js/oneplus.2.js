!function(a,b,c,d,e){function g(){var d,f,a=decodeURIComponent(b.location.search.substring(1)),c=a.split("&"),g={};for(f=0;f<c.length;f++)d=c[f].split("="),d[1]!==e&&(g[d[0]]=d[1]);return g}function h(a){var b,c;return document.cookie.length>0&&(b=document.cookie.indexOf(a+"="),-1!=b)?(b=b+a.length+1,c=document.cookie.indexOf(";",b),-1==c&&(c=document.cookie.length),unescape(document.cookie.substring(b,c))):""}function i(a,b,c){var d=new Date;d.setDate(d.getDate()+c),document.cookie=a+"="+escape(b)+(null==c?"":";expires="+d.toGMTString())}function j(){var a=b.prompt("请输入您的密钥");a&&i("etKey",a,365)}if(!a.et){var f={};!function(a){"use strict";function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(255&a[b>>5]>>>b%32);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;16>c;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(15&b>>>4)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}"function"==typeof define&&define.amd?define(function(){return t}):a.md5=t}(f),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){var b,c,d;!a.support.cors&&a.ajaxTransport&&window.XDomainRequest&&(b=/^https?:\/\//i,c=/^get|post$/i,d=new RegExp("^"+location.protocol,"i"),a.ajaxTransport("* text html xml json",function(e,f){if(e.crossDomain&&e.async&&c.test(e.type)&&b.test(e.url)&&d.test(e.url)){var h=null;return{send:function(b,c){var d="",g=(f.dataType||"").toLowerCase();h=new XDomainRequest,/^\d+$/.test(f.timeout)&&(h.timeout=f.timeout),h.ontimeout=function(){c(500,"timeout")},h.onload=function(){var i,b="Content-Length: "+h.responseText.length+"\r\nContent-Type: "+h.contentType,d={code:200,message:"success"},e={text:h.responseText};try{if("html"===g||/text\/html/i.test(h.contentType))e.html=h.responseText;else if("json"===g||"text"!==g&&/\/json/i.test(h.contentType))try{e.json=a.parseJSON(h.responseText)}catch(f){d.code=500,d.message="parseerror"}else if("xml"===g||"text"!==g&&/\/xml/i.test(h.contentType)){i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1;try{i.loadXML(h.responseText)}catch(f){i=void 0}if(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)throw d.code=500,d.message="parseerror","Invalid XML: "+h.responseText;e.xml=i}}catch(j){throw j}finally{c(d.code,d.message,e,b)}},h.onprogress=function(){},h.onerror=function(){c(500,"error",{text:h.responseText})},f.data&&(d="string"===a.type(f.data)?f.data:a.param(f.data)),h.open(e.type,e.url),h.send(d)},abort:function(){h&&h.abort()}}}}))}),a.extend({et:function(e,i){function p(d,e){function ab(){var b,c,d;if(R)for(b=e.notElements.split(","),c=0,d=b.length;d>c;c++)a(b[c]).remove();U=a(e.selectors).not("."+_)}function bb(a){return a.split("").sort().join("")}function cb(b){return(b.indexOf("http")>-1||b.indexOf("https")>-1)&&(b=b.replace(/(http|https):\/\/(.+?)(["'\/])/g,"$3")),b=a.trim(bb(b))}function db(b){var f,g,c=b.outerHTML,d=a(c),e=["class","style","src"];for(f=0,g=e.length;g>f;f++)d.removeAttr(e[f]);return c=d[0].outerHTML}function eb(){U.each(function(){var c,d,e,b=a(this);"1"!=b.attr(Z)&&(c=cb(db(this)),d=f.md5(c),e=N.indexOf(d),e>-1&&(O[d]?O[d].push(N.length):O[d]=[e,N.length],d+=O[d].length),N.push(d),S&&(T[d]={el:this,old_html:db(this)}),b.attr(n,d).attr(Z,"1"))})}function fb(){q||(q=y.val(),p=a("["+n+'="'+q+'"]'))}function gb(a){fb(),d[q]=a,p.css(i).attr(o,a).attr("title",a)}function hb(){fb(),delete d[q],p.css(g).attr(o,"").attr("title","")}function ib(b,c){var d,e,f,g;if(Y)for(d=a.trim(p.attr(Y.useAttr)).split(Y.attrSep),e=a("["+Y.useAttr+'^="'+d[0]+Y.attrSep+'"]'),f=0,g=e.length;g>f;f++)p=a(e[f]),q=p.attr(n),c?hb():gb(b)}function jb(a){return isNaN(a)&&(a=a.charCodeAt(0)-96),a}function kb(a){var b;return(b=a.indexOf(Y.imgSrcPrefix))>-1?jb(a.charAt(b+1)):""}function lb(){U.each(function(){p=a(this),q=p.attr(n),s=d[q],(s||p.attr(o))&&(s&&p.attr(o,s),s&&gb(s)),S&&T[q]&&(T[q].now_html=db(this)),q=null,s=null})}function mb(a,b){for(var c in a)if(b==a[c])return!0;return!1}function nb(a,b){var c=s||x.val();return c?a&&mb(d,c)?(qb("埋点描述不能重复"),!1):c.length>100?(qb("埋点描述超过100个字符"),!1):(gb(c),ib(c),q=null,v.hide(),!b&&L.show(),a&&a.preventDefault(),!1):(qb("请填写埋点描述"),!1)}function ob(b,c,d,f){var h,i,j,g=[];return"_opq.push"==e.handleFn?(g=["trackEvent",b,c],Y&&(h=a.trim(d.attr(Y.useAttr)).split(Y.attrSep),i=f.clientX?f.clientX+"*"+f.clientY:f.screenX+"*"+f.screenY,2==h.length&&(j=["abtest=1","experimentId="+h[0],"variantId="+(h[1]&&jb(h[1]))||kb(d[0].outerHTML),"clickPos="+i],g.push(j)))):"_gaq.push"==e.handleFn&&(g=["_trackEvent",c,"clicked","from_ET",1]),g}function pb(){for(var b in d)!function(b){"_"!=b[0]&&a("["+n+'="'+b+'"]['+$+'!="1"]').attr($,"1").on("click",function(c){var e=a(this);Q(ob(b,d[b],e,c))})}(b);a("["+o+"]["+$+'!="1"]').attr($,"1").on("click",function(b){var c=a(this),d=c.attr(n)||f.md5(cb(this.outerHTML?db(this):db(b.target)));Q(ob(d,c.attr(o),c,b))})}function qb(a){G.html(a),I.show()}function rb(){G.html(""),I.hide()}function sb(){I=a(H).appendTo(m),G=I.find("#modal"),J=I.find("#modalHide"),K=I.find("#stillSave"),J.on("click",rb)}function tb(a,b,c){var d,e=a.clientX+10,f=a.clientY+10;c?(e-=190,f-=210):((d=e+v.outerWidth(!0)-l.width())>0&&(e-=d+20),(d=f+v.outerHeight(!0)+w.outerHeight(!0)-l.height())>0&&(f-=d+20)),v.css({display:"block",left:e+"px",top:f+"px"}),q||(q=""),y.val(q),x.val(b||""),b&&(x[0].selectionStart=b.length,x[0].selectionEnd=b.length),x.trigger("focus")}function ub(){X.__url__=e.url,X.__targeturl__=e.targeturl||e.url,X.__selectors__=e.selectors,X.__blockSelectors__=e.blockSelectors,X.__updateDate__=+new Date,X.__etKey__=h("etKey"),X.__handleFn__=e.handleFn,d=a.extend(d,X)}function wb(){return new Date-vb>3e4?(console&&console.log&&console.log("Error: Load analysis tool with over time - ",e.handleFn,"."),void 0):(Q||b.setTimeout(function(){for(P=e.handleFn.split("."),Q=b[P.shift()];P.length&&Q;)pb(),Q=Q[P.shift()];wb()},100),void 0)}function xb(a){for(var c,b=0,d=0,e=a.length;e>d;d++)if(c=a[d],3==c.nodeType&&b++,c.className&&c.className.indexOf(_)>-1||c.outerHTML&&c.outerHTML.indexOf("-9999px")&&("t"==c.innerText||"t"==c.textContent))return!0;return b==e?!0:!1}function zb(){function c(){W=w.find("#maximize"),V=w.find("#minimize");var b=w.find("#btns");W.on("click",function(){b.show(),w.css({width:"100%","border-radius":"0"}),a(this).hide(),V.show()}),V.on("click",function(){b.hide(),w.css({width:"0","border-radius":"50px 0 0"}),a(this).hide(),W.show()})}function f(){var b,c,e,f,g,d=[];if(U.each(function(){c=a(this),b=a.trim(c.text()),b&&(s=b,q=c.attr(n),p=c,nb(null,!0),s=null,d.push(b))}),d.length){for(e=['<p class="'+_+'">当前页面自动添加 '+d.length+" 处埋点：</p>"],f=0,g=d.length;g>f;f++)e.push('<p class="'+_+'" style="margin-left:28px;"><b class="'+_+'">'+(f+1)+"</b>、"+d[f]+"</p>");qb(e.join("")),L.show()}}function g(c){ub(),c!==!0&&h("save")||(M.text("保存中..."),B.prop("disabled",!0),a.ajax({url:e.server+"/set",type:"post",dataType:"json",data:d,success:function(a){a.success&&L.hide(),M.text(""),r.fadeTo("slow",.5).text(a.msg||"保存失败"),b.setTimeout(function(){r.text("").fadeOut(),M.text("保存"),B.prop("disabled",!1)},2e3)},error:function(a){M.text("保存"),B.prop("disabled",!1),qb(a.responseText||"保存失败"),j()}}))}function h(a){var f,g,h,b=[],c=[],e=0;for(f in d)"_"!=f[0]&&(e++,-1==N.indexOf(f)&&c.push(f));if(c.length){for(b=['<p class="'+_+'">当前页面共计 '+e+' 处埋点， <span class="'+_+'" style="color: red">'+c.length+"</span> 处埋点丢失</p>",'<p class="'+_+'">错误埋点的描述列表'],g=0,h=c.length;h>g;g++)b.push('<p class="'+_+'" style="margin-left:28px;"><b class="'+_+'">'+(g+1)+"</b>、"+d[c[g]]+"</p>");b.push('<p class="'+_+'" style="margin-top: 20px">PS：如有冲突埋点，则不能保存；埋点被修正后，冲突埋点将被删除。</p>')}else b=["当前页面共计 "+e+' 处埋点， 所有埋点状态<span class="'+_+'" style="font-weight:bold;color: green">正常</span>'],K.hide();return"string"==typeof a?c.length?("save"==a&&(K.show(),qb(b.join(""))),c):!1:(qb(b.join("")),void 0)}function i(){var b,c,a=h("fix");if(!a.length)return qb("没有异常的埋点，无需进行修正");for(b=0,c=a.length;c>b;b++)delete d[a[b]];L.show(),D.text("已修正").attr("disabled",!0)}t=['<div class="'+_+'" style="font-size:12px;line-height:30px;display:none;z-index:1000008;background-color:#ffffff;position:fixed;padding:2em;border-radius:.5em;border:1px solid #cccccc;">','<div class="'+_+'" style="position:absolute;top:3px;right:10px;color:red;cursor:pointer;" onclick="this.parentNode.style.display=\'none\';">X</div>','<p class="'+_+'">埋点键值：<input style="width: 220px" class="'+_+'" id="trackTipKey" type="text" /></p>','<p class="'+_+'">埋点描述：<input style="width: 220px" class="'+_+'" id="trackTip" type="text" /></p>','<p class="'+_+'" style="text-align:right;margin-top:10px;"><button class="'+_+'" id="btnSave" style="padding:0 10px;" type="button">保存</button>','<button class="'+_+'" id="btnDel" style="padding:0 10px;margin-left:10px" type="button">删除埋点</button></p>',"</div>"].join(""),u=['<div class="'+_+'" id="_etBtns" style="transition: width 0.2s;width:100%;box-sizing:border-box;font-size:16px;z-index:1000009;background-color:#ffffff;border-top:1px solid #aaaaaa;position:fixed;bottom:0;right:0;padding:16px;">','<div class="'+_+'" id="maximize" title="最大化" style="display:none;cursor: pointer;font-size: 40px;font-weight: bold;position: absolute;right:1px;top:-3px;">+</div>','<div class="'+_+'" id="minimize" title="最小化" style="cursor: pointer;font-size: 40px;font-weight:bold;position:absolute;right:10px;top:-10px;">-</div>','<div class="'+_+'" id="btns" style="padding-right:68px;float:right;">','<button class="'+_+'" id="btnFix" style="display:inline-block;width:128px;height:48px;margin-right:80px;vertical-align:top;" type="button">修正埋点</button>','<button class="'+_+'" id="checkPage" style="display:inline-block;width:128px;height:48px;margin-right:80px;vertical-align:top;" type="button">检测埋点</button>','<button class="'+_+'" id="btnKeySave" style="display:inline-block;width:128px;height:48px;margin-right:80px;vertical-align:top;" type="button">键值添加</button>','<button class="'+_+'" id="btnAutoSave" style="display:inline-block;width:128px;height:48px;margin-right:80px;vertical-align:top;" type="button">自动添加</button>','<div class="'+_+'" style="display:inline-block;position:relative;width:128px;height:48px;line-height:48px;">','<button class="'+_+'" id="savePageData" style="position:absolute;top:0;width:100%;height:100%;" type="button"><b style="display:none;color:red">*</b><span>保存</span></button>','<div class="'+_+'" id="notice" style="position:absolute;top:0;width:100%;height:100%;display:none;background-color:#000000;color:#ffffff;text-align:center;">',"</div></div></div></div>"].join(""),v=a(t).appendTo(m),x=v.find("#trackTip"),y=v.find("#trackTipKey"),z=v.find("#btnSave"),A=v.find("#btnDel"),w=a(u).appendTo(m),B=w.find("#savePageData"),L=B.find("b"),M=B.find("span"),r=w.find("#notice"),C=w.find("#checkPage"),D=w.find("#btnFix"),F=w.find("#btnAutoSave"),E=w.find("#btnKeySave"),c(),E.on("click",function(a){q="",tb(a,null,!0)}),F.on("click",f),z.on("click",nb),B.on("click",g),K.on("click",function(){rb(),g(!0)}),C.on("click",h),D.on("click",i),A.on("click",function(a){return v.hide(),hb(),ib(null,!0),L.show(),a.preventDefault(),!1}),x.on("keypress",function(a){13==a.which?nb(a):27==a.keyCode&&v.hide()}),l.keypress(function(a){return 115==a.which&&a.ctrlKey||19==a.which?(!B.prop("disabled")&&g(),a.preventDefault(),!1):!0})}function Ab(){function b(b){var e,c=a(this).attr(n);if(c||!R)return p=a(this),q=c,e=d[q]||p.attr(o)||a(b.target).attr(o),q&&tb(b,e),b&&b.preventDefault(),!1}ab(),eb(),sb(),R?(U.css(g),zb(),lb(),a(c).on("click",e.selectors,b),e.blockSelectors&&a(e.blockSelectors).on("click",b)):wb()}var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,P,Q,S,U,V,W,vb,yb,g={border:"2px solid red","box-sizing":"border-box"},i={border:"2px solid green"},l=a(b),m=a("body"),n="track-key",o="track-data",N=[],O={},T={},X={},Y=window._opab&&window._opab.config,Z="et-attached",$="et-attached-click",_="et-notSetStyle",R=1==e.setMode;1==e.setMode&&(S=!0,window.etDebug=function(a){return T[a]}),H=['<div class="'+_+'" style="text-align:center;display:none;position:fixed;width:100vw;height:100vh;font-size:14px;top:0;left:0;z-index:1000000;">','<div class="'+_+'" style="background-color:#000000;opacity:0.5;width:100%;height:100%;z-index:10000;position:absolute;top:0;left:0;"></div>','<div class="'+_+'" style="position:relative;text-align:left;display:inline-block;background-color:#ffffff;line-height:32px;border-radius:2px;padding:20px;margin:150px auto 0;z-index:20000;"><div class="'+_+'" style="max-height:400px;min-width:350px;overflow:auto;" id="modal"></div>','<button class="'+_+'" id="modalHide" style="float:right;margin:10px 20px 0 0;padding:0 10px;margin-left:10px;border:1px solid #aaaaaa;" type="button">确定</button>','<button class="'+_+'" id="stillSave" style="display:none;float:right;margin:10px 20px 0 0;padding:0 10px;margin-left:10px;border:1px solid #aaaaaa;" type="button">仍要保存</button></div>',"</div></div>"].join(""),vb=new Date,yb=function(){var c,a=window.MutationObserver||window.WebKitMutationObserver,b=window.addEventListener,d=function(a,b){clearTimeout(c),c=setTimeout(a,b)};return function(c,e,f){if(a){var g=new a(function(a){a[0].addedNodes.length&&!xb(a[0].addedNodes)&&d(f,e)});g.observe(c,{childList:!0,subtree:!0})}else b&&c.addEventListener("DOMNodeInserted",function(){d(f,e)},!1)}}(),b.setTimeout(function(){Ab(),yb(m[0],500,function(){ab(),eb(),R?(a("a").attr("href","javascript:;"),U.css(g),lb()):pb()}),R&&(a("a").attr("href","javascript:;"),h("etKey")||j())},1e3)}var k={setMode:0,debug:0,selectors:"a,button,[track-data],.btn",handleFn:"_opq.push",url:b.location.origin+b.location.pathname,server:d,notElements:".op-top-header,.op-footer"},l=g(),m=l.handleFn,n=l.selectors,o=l.blockSelectors;l.selectors&&delete l.selectors,e=e||{},i=a.extend(k,i,l),a.ajax({url:i.server+"/get?targeturl="+(i.targeturl||i.url),type:"get",dataType:"json",success:function(b){e=a.extend(e,b),i.selectors=e.__selectors__||i.selectors,n&&(i.selectors+=","+n),i.blockSelectors=e.__blockSelectors__||i.blockSelectors,o&&(i.blockSelectors+=","+o),i.handleFn=e.__handleFn__||i.handleFn,m&&(i.handleFn=m),new p(e,i)},error:function(){n&&(i.selectors+=","+n),new p(e,i)}})}}),a(function(){a.et()})}};